#parse("admin_header.vm")
#parse("admin_sidebar.vm")
<link rel="stylesheet" href="/static/editor/themes/default/default.css" />
<script type="text/javascript">
	$("#sidebar_li_2").siblings().removeClass('active')
	$("#sidebar_li_2").addClass('active');
	function _topAddCatChanged() {
		var sel_top_cat = $("#top_cats_add option:selected").val();
		$.ajax({
			url: "/admin/sub_cat_list",
			type: "post",
			data: {parentId:sel_top_cat},
			dataType: "html",
			success:function(data){
				$("#sub_cats_add").find('option').remove() ;
				var cat_array =eval(data);
				for(var i_cat=0; i_cat<cat_array.length; i_cat++) {
					$("#sub_cats_add").append('<option value="'+ cat_array[i_cat].id +'">'+ cat_array[i_cat].catName +'</option>');
				}
			},
			error:function(){
			}
		});
	}
	function _subAddCatChanged() {
		var sel_sub_cat = $("#sub_cats_add option:selected").val();
		$.ajax({
			url: "/admin/fetch_articles",
			type: "post",
			data: {subCatId:sel_sub_cat},
			dataType: "html",
			success:function(data){
				$("#articles").find('option').remove() ;
				var article_array =eval(data);
				for(var i_article=0; i_article<article_array.length; i_article++) {
					$("#articles").append('<option value="'+ article_array[i_article].id +'">◆ '+ article_array[i_article].title +'</option>');
				}
			},
			error:function(){
			}
		});
		
	}
</script>

<div id="content">
	<div id="content-header">
		<h1>Slide管理</h1>
		<div class="btn-group">
			<a class="btn btn-large tip-bottom" title="Manage Files"><i class="icon-file"></i></a>
			<a class="btn btn-large tip-bottom" title="Manage Users"><i class="icon-user"></i></a>
			<a class="btn btn-large tip-bottom" title="Manage Comments"><i class="icon-comment"></i><span class="label label-important">5</span></a>
			<a class="btn btn-large tip-bottom" title="Manage Orders"><i class="icon-shopping-cart"></i></a>
		</div>
	</div>
	<div id="breadcrumb">
		<a href="/admin/article_list" title="Go to Home" class="tip-bottom"><i class="icon-home"></i> 首页</a>
		<a href="#" class="current">添加Slide</a>
	</div>
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span12">
				<div class="widget-box">
					<div class="widget-title">
						<span class="icon">
							<i class="icon-align-justify"></i>									
						</span>
						<h5>添加Slide</h5>
					</div>
					<div class="widget-content padding">
						<form action="javascript:void(0)" method="post" class="form-horizontal" id="article_add_form">
							<div class="control-group">
								<label class="control-label">Slide标题</label>
								<div class="controls">
									<input type="text" id="title" name="title">
								</div>
							</div>
							<div class="control-group">
								<label class="control-label">Slide简介</label>
								<div class="controls">
									<input type="text" id="brief" name="brief">
								</div>
							</div>
							
							<div class="control-group">
								<label class="control-label">选择文章</label>
								<div class="controls">
									<select id="top_cats_add" onchange="_topAddCatChanged()">
										#foreach($topCat in $top_cat_list)
											#if ($topCat.id == $topCatId)
												<option value="$topCat.id" selected>$topCat.catName</option>
											#else
												<option value="$topCat.id">$topCat.catName</option>
											#end
										#end
									</select>
									&nbsp;
									<select id="sub_cats_add" onchange="_subAddCatChanged()">
										#foreach($init_sub in $init_sub_cat_list)
											#if ($init_sub.id == $subCatId)
												<option value="$init_sub.id" selected>$init_sub.catName</option>
											#else
												<option value="$init_sub.id" >$init_sub.catName</option>
											#end
										#end
									</select>
									<select id="articles" style="width:500px;">
										#foreach($article in $init_article_list)
											<option value="$article.id">◆ $article.title</option>
										#end
									</select>
								</div>
							</div>
							<div class="control-group" >
								<label class="control-label">Slide图片</label>
								<div class="controls">
									<input type="text" id="picName" value=""/><input type="button" id="image3" value="选择图片" />
							    </div>
							<div class="control-group" >
								<div class="controls">
									<button class="btn btn-primary" id="yes_add">&nbsp;&nbsp;提交&nbsp;&nbsp;</button>
							    </div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function(){
		$("#yes_add").click(function(check) {
			var _title = $("#title").val();
			var _brief = $("#brief").val();
			var _articleId = $("#articles option:selected").val();
			var _picName = $("#picName").val();
			
			$.ajax({
				url: "/admin/add_slide",
				type: "post",
				data: {title:_title, brief:_brief, articleId:_articleId, picName:_picName},
				dataType: "html",
				success: function(data) {
					window.location.href = "/admin/slide_list";
				},
				error: function(data) {
					window.location.href = "/admin/slide_list";
				}
			});
			
		});
	});
</script>
<script charset="utf-8" src="/static/editor/kindeditor.js"></script>
<script charset="utf-8" src="/static/editor/lang/zh_CN.js"></script>
<script>
KindEditor.ready(function(K) {
	var editor = K.editor({
		allowFileManager : true
	});
	K('#image3').click(function() {
		editor.loadPlugin('image', function() {
			editor.plugin.imageDialog({
				showRemote : true,
				imageUrl : K('#picName').val(),
				clickFn : function(url, title, width, height, border, align) {
					K('#picName').val(url);
					editor.hideDialog();
				}
			});
		});
	});
});
</script>
#parse("admin_footer.vm")